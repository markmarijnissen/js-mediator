!function(){function r(r){return r.map(function(r){return e[r]})}var o={},e={},t=[],n=[],a={};o.register=function(o,a){if("string"!=typeof o)throw new Error("Name must be a string!");if("object"!=typeof a)throw new Error("Must register an object!");var u=o[0]===o[0].toLowerCase();if(u)e[o]||(e[o]=[]),e[o].push(a);else{if(e[o])throw new Error("Module "+o+" already exists!");e[o]=a;for(var i=t.length-1;i>=0;i--){var l=t[i],c=l.waitFor.indexOf(o);if(c>-1&&(l.waitFor.splice(c,1),0===l.waitFor.length)){var f=r(l.modules);l.callback.apply(null,f),t.splice(i,1)}}}return n.forEach(function(r){r(a,o)}),a},o.couple=function(n,u){if(claimed=n.filter(function(r){var o=!!a[r];return o&&(a[r]=!0),o}),claimed.length>0)throw new Error("Cannot group modules "+claimed.join(",")+": They are already coupled!");var i=n.filter(function(r){return!e[r]});return 0===i.length?u.apply(null,r(n)):t.push({waitFor:i,modules:n,callback:u}),o},o.forEach=function(r,t,a){if(Array.isArray(r)&&"function"==typeof t&&(a=t,t=r,r=null),"function"==typeof r&&(a=r,t=[],r=null),"function"==typeof t&&(a=t,t=[]),"function"!=typeof a)throw new Error("Callback is not a function!");return o.couple(t,function(o){o=Array.prototype.slice.apply(arguments);var t=function(e,t){(r===!1||r===t)&&a.apply(null,[e,t].concat(o))};n.push(t),Object.keys(e).forEach(function(r){var o=e[r];Array.isArray(o)?o.forEach(function(o){t(o,r)}):t(o,r)})}),o},o.group=function(r,e,t){if(r[0]!==r[0].toUpperCase())throw new Error("Group is a Module, so the name should start with UpperCase.");return o.couple(e,function(){var e={};e=t.apply(e,arguments)||e,o.register(r,e)}),o},window.Mediator=o,module&&module.exports&&(module.exports=o)}();